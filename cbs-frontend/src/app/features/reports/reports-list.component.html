<div class="reports-container">
  <div class="page-header">
    <h1>Daily Reports</h1>
    <button class="btn-primary" (click)="openCreateModal()">+ Create Report</button>
  </div>

  @if (loading()) {
    <div class="loading">Loading reports...</div>
  }

  @if (error()) {
    <div class="error-message">{{ error() }}</div>
  }

  @if (!loading() && reports().length === 0) {
    <div class="empty-state">
      <div class="empty-icon">üìù</div>
      <h3>No reports found</h3>
      <p>Create your first daily report</p>
      <button class="btn-primary" (click)="openCreateModal()">Create Report</button>
    </div>
  }

  @if (reports().length > 0) {
    <div class="reports-list">
      @for (report of reports(); track report.id) {
        <div class="report-card">
          <div class="report-header">
            <div>
              <h3>{{ report.reportDate | date:'EEEE, MMMM dd, yyyy' }}</h3>
              <span class="hours-badge">{{ report.hoursWorked }} hours</span>
            </div>
            <span class="status-badge" [ngClass]="getStatusClass(report.status)">
              {{ report.status }}
            </span>
          </div>
          
          <div class="report-content">
            <div class="content-section">
              <h4>Summary</h4>
              <p>{{ report.summary }}</p>
            </div>
            <div class="content-section">
              <h4>Tasks Completed</h4>
              <p>{{ report.tasksCompleted }}</p>
            </div>
          </div>

          <div class="report-footer">
            <span class="report-date">Created {{ report.createdAt | date:'short' }}</span>
            <div class="report-actions">
              <button class="btn-link" (click)="openEditModal(report)">Edit</button>
              <button class="btn-link-danger" (click)="confirmDelete(report.id)">Delete</button>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>

<app-modal [show]="showModal()" [title]="isEditing() ? 'Edit Report' : 'Create Report'" (close)="closeModal()">
  <form (ngSubmit)="saveReport()" class="report-form">
    <div class="form-row">
      <div class="form-group">
        <label for="reportDate">Date *</label>
        <input type="date" id="reportDate" [(ngModel)]="formData.reportDate" name="reportDate" required />
      </div>
      <div class="form-group">
        <label for="hoursWorked">Hours Worked *</label>
        <input type="number" id="hoursWorked" [(ngModel)]="formData.hoursWorked" name="hoursWorked" min="0" max="24" step="0.5" required />
      </div>
    </div>

    <div class="form-group">
      <label for="summary">Summary *</label>
      <textarea id="summary" [(ngModel)]="formData.summary" name="summary" rows="3" required placeholder="Summarize your day's work"></textarea>
    </div>

    <div class="form-group">
      <label for="tasksCompleted">Tasks Completed *</label>
      <textarea id="tasksCompleted" [(ngModel)]="formData.tasksCompleted" name="tasksCompleted" rows="3" required placeholder="List tasks you completed"></textarea>
    </div>

    <div class="form-group">
      <label for="challenges">Challenges</label>
      <textarea id="challenges" [(ngModel)]="formData.challenges" name="challenges" rows="2" placeholder="Any challenges faced?"></textarea>
    </div>

    <div class="form-group">
      <label for="nextDayPlan">Next Day Plan</label>
      <textarea id="nextDayPlan" [(ngModel)]="formData.nextDayPlan" name="nextDayPlan" rows="2" placeholder="Plans for tomorrow"></textarea>
    </div>

    <div class="form-group">
      <label for="status">Status *</label>
      <select id="status" [(ngModel)]="formData.status" name="status" required>
        <option value="DRAFT">Draft</option>
        <option value="SUBMITTED">Submitted</option>
        <option value="APPROVED">Approved</option>
        <option value="REJECTED">Rejected</option>
      </select>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-cancel" (click)="closeModal()">Cancel</button>
      <button type="submit" class="btn-primary">{{ isEditing() ? 'Update' : 'Create' }}</button>
    </div>
  </form>
</app-modal>

<app-modal [show]="showDeleteConfirm()" [title]="'Confirm Delete'" (close)="cancelDelete()">
  <div class="delete-confirm">
    <p>Are you sure you want to delete this report? This action cannot be undone.</p>
    <div class="delete-actions">
      <button type="button" class="btn-cancel" (click)="cancelDelete()">Cancel</button>
      <button type="button" class="btn-danger" (click)="deleteReport()">Delete</button>
    </div>
  </div>
</app-modal>
